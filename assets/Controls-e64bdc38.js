var w=Object.defineProperty;var v=(h,t,i)=>t in h?w(h,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[t]=i;var e=(h,t,i)=>(v(h,typeof t!="symbol"?t+"":t,i),i);import{A as f,g as c,h as z,b as l}from"./index-87fda849.js";import{c as d,i as A,t as y,f as x,e as k,b as M}from"./mat4-e742a724.js";function p(){var h=new f(4);return f!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0,h[3]=0),h}function u(h,t,i,s,o){return h[0]=t,h[1]=i,h[2]=s,h[3]=o,h}function g(h,t,i){var s=t[0],o=t[1],n=t[2],r=t[3];return h[0]=i[0]*s+i[4]*o+i[8]*n+i[12]*r,h[1]=i[1]*s+i[5]*o+i[9]*n+i[13]*r,h[2]=i[2]*s+i[6]*o+i[10]*n+i[14]*r,h[3]=i[3]*s+i[7]*o+i[11]*n+i[15]*r,h}(function(){var h=p();return function(t,i,s,o,n,r){var a,m;for(i||(i=4),s||(s=0),o?m=Math.min(o*i+s,t.length):m=t.length,a=s;a<m;a+=i)h[0]=t[a],h[1]=t[a+1],h[2]=t[a+2],h[3]=t[a+3],n(h,h,r),t[a]=h[0],t[a+1]=h[1],t[a+2]=h[2],t[a+3]=h[3];return t}})();class T{constructor(t="ORBITING_TYPE"){e(this,"type");e(this,"position");e(this,"focus");e(this,"home");e(this,"up");e(this,"right");e(this,"normal");e(this,"matrix");e(this,"steps");e(this,"azimuth");e(this,"elevation");e(this,"fov");e(this,"minZ");e(this,"maxZ");this.type=t,this.position=c(),this.focus=c(),this.home=c(),this.up=c(),this.right=c(),this.normal=c(),this.matrix=d(),this.steps=0,this.azimuth=0,this.elevation=0,this.fov=45,this.minZ=.1,this.maxZ=1e4}get isOrbiting(){return this.type==="ORBITING_TYPE"}get isTracking(){return this.type==="TRACKING_TYPE"}goHome(t){t&&(this.home=t),this.setPosition(this.home),this.setAzimuth(0),this.setElevation(0)}dolly(t){const i=c(),s=c();z(i,this.normal);const o=t-this.steps;this.isTracking?(s[0]=this.position[0]-o*i[0],s[1]=this.position[1]-o*i[1],s[2]=this.position[2]-o*i[2]):(s[0]=this.position[0],s[1]=this.position[1],s[2]=this.position[2]-o),this.steps=t,this.setPosition(s)}setPosition(t){l(this.position,t),this.update()}changeZoom(t){l(this.position,[this.position[0],this.position[1],this.position[2]+t]),this.update()}setFocus(t){l(this.focus,t),this.update()}setAzimuth(t){this.changeAzimuth(t-this.azimuth)}changeAzimuth(t){this.azimuth+=t,(this.azimuth>360||this.azimuth<-360)&&(this.azimuth=this.azimuth%360),this.update()}setElevation(t){this.changeElevation(t-this.elevation)}changeElevation(t){this.elevation+=t,(this.elevation>360||this.elevation<-360)&&(this.elevation=this.elevation%360),this.update()}calculateOrientation(){const t=p();u(t,1,0,0,0),g(t,t,this.matrix),l(this.right,t);const i=p();u(i,0,1,0,0),g(i,i,this.matrix),l(this.up,i);const s=p();u(s,0,0,1,0),g(s,s,this.matrix),l(this.normal,s)}update(){if(A(this.matrix),this.isTracking?(y(this.matrix,this.matrix,this.position),x(this.matrix,this.matrix,this.azimuth*Math.PI/180),k(this.matrix,this.matrix,this.elevation*Math.PI/180)):(x(this.matrix,this.matrix,this.azimuth*Math.PI/180),k(this.matrix,this.matrix,this.elevation*Math.PI/180),y(this.matrix,this.matrix,this.position)),this.isTracking){const t=p();u(t,0,0,0,1),g(t,t,this.matrix),l(this.position,t)}this.calculateOrientation()}getViewTransform(){const t=d();return M(t,this.matrix),t}}class E{constructor(t,i){e(this,"camera");e(this,"canvas");e(this,"picker");e(this,"dragging",!1);e(this,"ctrl",!1);e(this,"alt",!1);e(this,"x",0);e(this,"y",0);e(this,"lastX",0);e(this,"lastY",0);e(this,"button",0);e(this,"dloc",0);e(this,"dstep",0);e(this,"motionFactor",10);e(this,"keyIncrement",5);this.camera=t,this.canvas=i,this.picker=null,i.onmousedown=s=>this.onMouseDown(s),i.onmouseup=s=>this.onMouseUp(s),i.onmousemove=s=>this.onMouseMove(s),window.onkeydown=s=>this.onKeyDown(s),window.onkeyup=s=>this.onKeyUp(s),window.onwheel=s=>this.onWheel(s)}setPicker(t){this.picker=t}get2DCoords(t){let i=0,s=0,o=this.canvas;for(;o&&o.tagName!=="BODY";)i+=o.offsetTop,s+=o.offsetLeft,o=o.offsetParent;return s+=window.pageXOffset,i-=window.pageYOffset,{x:t.clientX-s,y:this.canvas.height-(t.clientY-i)}}onMouseUp(t){this.dragging=!1,this.picker&&(t.shiftKey||(this.picker.picking=!1,this.picker.stop()))}onMouseDown(t){if(this.dragging=!0,this.x=t.clientX,this.y=t.clientY,this.button=t.button,this.dstep=Math.max(this.camera.position[0],this.camera.position[1],this.camera.position[2])/100,!this.picker)return;const i=this.get2DCoords(t);this.picker.picking=!!this.picker.find(i),this.picker.picking||this.picker.stop()}onMouseMove(t){var o,n;if(this.lastX=this.x,this.lastY=this.y,this.x=t.clientX,this.y=t.clientY,!this.dragging)return;this.ctrl=t.ctrlKey,this.alt=t.altKey;const i=this.x-this.lastX,s=this.y-this.lastY;if(this.picker&&this.picker.picking){(n=(o=this.picker.callbacks).move)==null||n.call(o,i,s,this.alt);return}this.button||(this.alt?this.dolly(s):this.rotate(i,s))}onKeyDown(t){if(this.ctrl=t.ctrlKey,!this.ctrl)switch(t.key){case"ArrowLeft":return this.camera.changeAzimuth(-this.keyIncrement);case"ArrowUp":return this.camera.changeElevation(this.keyIncrement);case"ArrowRight":return this.camera.changeAzimuth(this.keyIncrement);case"ArrowDown":return this.camera.changeElevation(-this.keyIncrement)}}onKeyUp(t){this.ctrl=t.ctrlKey}onWheel(t){this.camera.changeZoom(t.deltaY)}dolly(t){t>0?this.dloc+=this.dstep:this.dloc-=this.dstep,this.camera.dolly(this.dloc)}rotate(t,i){const{width:s,height:o}=this.canvas,n=-20/s,r=-20/o,a=t*n*this.motionFactor,m=i*r*this.motionFactor;this.camera.changeAzimuth(a),this.camera.changeElevation(m)}}export{T as C,E as a};
