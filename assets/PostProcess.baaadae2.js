import{b as T,c as n}from"./webgl.82b1ccd1.js";class m{constructor(e,r,i){this.gl=e,this.canvas=e.canvas;const s=this.canvas.width,a=this.canvas.height,f=e.createTexture();e.bindTexture(e.TEXTURE_2D,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,s,a,0,e.RGBA,e.UNSIGNED_BYTE,null);const o=T(e,s,a,f),[u,h]=E(e);this.framebuffer=o,this.vertexBuffer=u,this.textureBuffer=h,this.startTime=Date.now(),this.configureShader(r,i)}configureShader(e,r){const i=this.gl;this.program&&this.program.dispose(),this.program=n(i,e,r,[],[])}validateSize(){const{width:e,height:r}=this.canvas;this.framebuffer.resize(e,r)}drawToFramebuffer(e){this.validateSize(),this.framebuffer.use(e)}draw(e){const r=this.gl,{width:i,height:s}=this.canvas;this.program.use(),r.enableVertexAttribArray(this.program.attributes.aVertexPosition),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(this.program.attributes.aVertexPosition,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this.program.attributes.aVertexTextureCoords),r.bindBuffer(r.ARRAY_BUFFER,this.textureBuffer),r.vertexAttribPointer(this.program.attributes.aVertexTextureCoords,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.framebuffer.texture),this.program.setUniform("uSampler","sampler2D",0),this.program.uniforms.uTime&&this.program.setUniform("uTime","float",(Date.now()-this.startTime)/1e3),this.program.uniforms.uInverseTextureSize&&this.program.setUniform("uInverseTextureSize","vec2",[1/i,1/s]),e==null||e(),r.drawArrays(r.TRIANGLES,0,6)}dispose(){this.program.dispose(),this.framebuffer.dispose(),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.textureBuffer)}}const E=t=>{const e=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],r=[0,0,1,0,0,1,0,1,1,0,1,1],i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);const s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),[i,s]};export{m as P};
