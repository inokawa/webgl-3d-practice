import{c as f}from"./webgl.0c8613b1.js";class a{constructor(e,r,t){this.gl=e,this.texture=null,this.framebuffer=null,this.renderbuffer=null,this.vertexBuffer=null,this.textureBuffer=null,this.startTime=Date.now(),this.canvas=e.canvas,this.configureFramebuffer(),this.configureGeometry(),this.configureShader(r,t)}configureFramebuffer(){const e=this.gl,{width:r,height:t}=this.canvas;this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,t,0,e.RGBA,e.UNSIGNED_BYTE,null),this.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r,t),this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}configureGeometry(){const e=this.gl,r=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],t=[0,0,1,0,0,1,0,1,1,0,1,1];this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW),this.textureBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)}configureShader(e,r){const t=this.gl;this.program&&this.program.dispose(),this.program=f(t,e,r,[],[])}validateSize(){const e=this.gl,{width:r,height:t}=this.canvas;e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,t,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r,t),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null)}drawToFramebuffer(e){const r=this.gl;this.validateSize(),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),e(),r.bindFramebuffer(r.FRAMEBUFFER,null)}draw(e){const r=this.gl,{width:t,height:i}=this.canvas;this.program.use(),r.enableVertexAttribArray(this.program.attributes.aVertexPosition),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(this.program.attributes.aVertexPosition,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this.program.attributes.aVertexTextureCoords),r.bindBuffer(r.ARRAY_BUFFER,this.textureBuffer),r.vertexAttribPointer(this.program.attributes.aVertexTextureCoords,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture),this.program.setUniform("uSampler","sampler2D",0),this.program.uniforms.uTime&&this.program.setUniform("uTime","float",(Date.now()-this.startTime)/1e3),this.program.uniforms.uInverseTextureSize&&this.program.setUniform("uInverseTextureSize","vec2",[1/t,1/i]),e==null||e(),r.drawArrays(r.TRIANGLES,0,6)}dispose(){this.program.dispose(),this.gl.deleteTexture(this.texture),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteRenderbuffer(this.renderbuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.textureBuffer)}}export{a as P};
