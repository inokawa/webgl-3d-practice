import{a as F,f as k}from"./index.e82e0eae.js";import{a as y,l as A}from"./webgl.0c8613b1.js";class B{constructor(e,t){this.gl=e,this.program=t,this.objects=[]}start(e){let t=!0,s;const a=()=>{s=requestAnimationFrame(c=>{!t||(e(this.objects,c),a())})},r=()=>{t=!1,s!=null&&cancelAnimationFrame(s)};a();const i=()=>{t=!0,a(),console.info("Clock resumed")},n=()=>{r(),console.info("Clock stopped")};return window.addEventListener("focus",i),window.addEventListener("blur",n),this.stop=()=>{window.removeEventListener("focus",i),window.removeEventListener("blur",n),r()}}get(e){return this.objects.find(t=>t.alias===e)}add(e,t,s){var m,x,j,g,v,V,w,O,C,E,K,R,T,z,L,N;const{gl:a,program:r}=this,i=(m=e.vertices)!=null?m:[],n=(x=e.indices)!=null?x:[],c=(j=e.scalars)!=null?j:[],l=(g=e.textureCoords)!=null?g:[],d=(v=e.diffuse)!=null?v:[1,1,1,1],u=(V=e.ambient)!=null?V:[.2,.2,.2,1],h=(w=e.specular)!=null?w:[1,1,1,1],p=(O=e.specularExponent)!=null?O:0,b=(C=e.d)!=null?C:1,o=[];"aVertexPosition"in r.attributes&&i.length&&o.push({name:"aVertexPosition",data:i,size:3}),"aVertexNormal"in r.attributes&&i.length&&n.length&&o.push({name:"aVertexNormal",data:F(i,n),size:3}),"aVertexColor"in r.attributes&&c.length&&o.push({name:"aVertexColor",data:c,size:4}),"aVertexTextureCoords"in r.attributes&&l.length&&(o.push({name:"aVertexTextureCoords",data:l,size:2}),"aVertexTangent"in r.attributes&&o.push({name:"aVertexTangent",data:k(i,l,n),size:3}));const f={alias:(E=e.alias)!=null?E:t,visible:(K=e.visible)!=null?K:!0,vertices:i,indices:n,scalars:c,textureCoords:l,wireframe:(R=e.wireframe)!=null?R:!1,diffuse:d,Kd:(T=e.Kd)!=null?T:d.slice(0,3),ambient:u,Ka:e.Ka||u.slice(0,3),specular:h,Ks:e.Ks||h.slice(0,3),specularExponent:p,Ns:(z=e.Ns)!=null?z:p,d:b,transparency:(L=e.transparency)!=null?L:b,illum:(N=e.illum)!=null?N:1,vao:y(a,r,o,n),...s};e.image&&(f.texture=A(a,e.image)),this.objects.push(f)}traverse(e){for(let t=0;t<this.objects.length&&!e(this.objects[t],t);t++);}renderFirst(e){const t=this.get(e),s=this.objects.indexOf(t);s!==0&&(this.objects.splice(s,1),this.objects.splice(0,0,t),this.printRenderOrder())}renderLast(e){const t=this.get(e),s=this.objects.indexOf(t);s!==0&&(this.objects.splice(s,1),this.objects.push(t),this.printRenderOrder())}renderSooner(e){const t=this.get(e),s=this.objects.indexOf(t);s!==0&&(this.objects.splice(s,1),this.objects.splice(s-1,0,t),this.printRenderOrder())}printRenderOrder(){const e=this.objects.map(t=>t.alias).join(" > ");console.info("Render Order:",e)}dispose(){var e;(e=this.stop)==null||e.call(this),this.program.dispose(),this.objects.forEach(t=>{var s;t.vao.dispose(),(s=t.texture)==null||s.dispose()})}}export{B as S};
